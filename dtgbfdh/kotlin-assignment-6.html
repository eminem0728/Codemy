<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–¥–∞–Ω–∏–µ 6: –ü–∞—Ä—Å–µ—Ä JSON - CodeLearn</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            line-height: 1.6;
        }
        .header {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.8em; font-weight: bold; text-decoration: none; color: white; }
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            text-decoration: none;
            transition: background 0.3s ease;
        }
        .back-btn:hover { background: rgba(255, 255, 255, 0.3); }
        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .assignment-header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
        }
        .assignment-title {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .assignment-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .content-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        .content-section h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        .content-section h3 {
            color: #ffd700;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
        }
        .content-section p { margin-bottom: 15px; font-size: 1.1em; }
        .code-example {
            background: rgba(0, 0, 0, 0.4);
            border-left: 4px solid #ffd700;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .code-example code {
            color: #00ff00;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .task-box {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .task-box h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }
        .solution-box {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .solution-box h4 {
            color: #51cf66;
            margin-bottom: 10px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }
        .nav-button {
            background: #ffd700;
            color: #333;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        .nav-button:hover { transform: translateY(-2px); }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <a href="courses.html" class="logo">üöÄ CodeLearn</a>
            <a href="course-kotlin.html" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –∫—É—Ä—Å—É</a>
        </div>
    </header>

    <div class="container">
        <div class="assignment-header">
            <h1 class="assignment-title">–ó–∞–¥–∞–Ω–∏–µ 6: –ü–∞—Ä—Å–µ—Ä JSON</h1>
            <div class="assignment-meta">
                <span>üÖ∫ Kotlin</span>
                <span>‚è±Ô∏è 120 –º–∏–Ω—É—Ç</span>
                <span>üìù –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ</span>
            </div>
        </div>

        <div class="content-section">
            <h2>üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
            <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä JSON –Ω–∞ Kotlin, –∫–æ—Ç–æ—Ä—ã–π —Å–º–æ–∂–µ—Ç —Ä–∞–∑–±–∏—Ä–∞—Ç—å JSON —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö Kotlin –∏ –æ–±—Ä–∞—Ç–Ω–æ. –≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å —Ä–∞–±–æ—Ç—É —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞.</p>
        </div>

        <div class="content-section">
            <h2>üéØ –¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>–°–æ–∑–¥–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è JSON –¥–∞–Ω–Ω—ã—Ö</li>
                <li>–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ —Å–ø—É—Å–∫–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞</li>
                <li>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã JSON –∑–Ω–∞—á–µ–Ω–∏–π</li>
                <li>–°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã Kotlin –æ–±—Ä–∞—Ç–Ω–æ –≤ JSON</li>
                <li>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞</li>
                <li>–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏</li>
            </ul>
        </div>

        <div class="task-box">
            <h4>üìù –ó–∞–¥–∞—á–∞</h4>
            <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON —Å –∫–ª–∞—Å—Å–∞–º–∏ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è JSON —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –ø–∞—Ä—Å–µ—Ä–æ–º –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ —Å—Ç—Ä–æ–∫ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.</p>
        </div>

        <div class="content-section">
            <h2>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sealed –∫–ª–∞—Å—Å—ã –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ JSON —ç–ª–µ–º–µ–Ω—Ç–æ–≤</li>
                <li>–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ª–µ–∫—Å–µ—Ä –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —Ç–æ–∫–µ–Ω—ã</li>
                <li>–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Å–ø—É—Å–∫ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞</li>
                <li>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å—Ç—Ä–æ–∫–∞—Ö</li>
                <li>–î–æ–±–∞–≤—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ JSON</li>
            </ul>
        </div>

        <div class="content-section">
            <h2>üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è</h2>
            
            <h3>1. –°–æ–∑–¥–∞–π—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é JSON —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h3>
            <div class="code-example">
                <code>sealed class JsonElement {
    data class JsonObject(val properties: Map<String, JsonElement>) : JsonElement()
    data class JsonArray(val elements: List<JsonElement>) : JsonElement()
    data class JsonString(val value: String) : JsonElement()
    data class JsonNumber(val value: Double) : JsonElement()
    data class JsonBoolean(val value: Boolean) : JsonElement()
    object JsonNull : JsonElement()
}</code>
            </div>

            <h3>2. –°–æ–∑–¥–∞–π—Ç–µ –ª–µ–∫—Å–µ—Ä</h3>
            <div class="code-example">
                <code>class JsonLexer(private val input: String) {
    private var position = 0
    
    fun tokenize(): List<Token>
    private fun isWhitespace()
    private fun isDigit()
    private fun nextToken()
}</code>
            </div>

            <h3>3. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä—Å–µ—Ä</h3>
            <div class="code-example">
                <code>class JsonParser(private val lexer: JsonLexer) {
    private var currentToken: Token
    
    fun parse(): JsonElement
    private fun parseObject(): JsonElement.JsonObject
    private fun parseArray(): JsonElement.JsonArray
    private fun parseValue(): JsonElement
}</code>
            </div>
        </div>

        <div class="content-section">
            <h2>üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞</h2>
            <div class="code-example">
                <code>=== –ü–ê–†–°–ï–† JSON ===
–í–≤–µ–¥–∏—Ç–µ JSON —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞:
{"name": "John", "age": 30, "city": "New York", "isStudent": false}

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞:
JsonObject(
    properties = {
        name = JsonString(John),
        age = JsonNumber(30.0),
        city = JsonString(New York),
        isStudent = JsonBoolean(false)
    }
)

=== –°–ï–†–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
–ò—Å—Ö–æ–¥–Ω—ã–π –æ–±—ä–µ–∫—Ç: User(name=Alice, age=25, hobbies=[reading, coding])
JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {"name":"Alice","age":25,"hobbies":["reading","coding"]}</code>
            </div>
        </div>

        <div class="content-section">
            <h2>üîß –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:</strong> Objects, Arrays, Strings, Numbers, Booleans, null</li>
                <li><strong>–°—Ç—Ä–æ–∫–∏:</strong> Escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (\n, \t, \", \\, \/)</li>
                <li><strong>–ß–∏—Å–ª–∞:</strong> –¶–µ–ª—ã–µ –∏ –¥—Ä–æ–±–Ω—ã–µ, –Ω–∞—É—á–Ω–∞—è –Ω–æ—Ç–∞—Ü–∏—è</li>
                <li><strong>–í–∞–ª–∏–¥–∞—Ü–∏—è:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</li>
                <li><strong>–û—à–∏–±–∫–∏:</strong> –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö</li>
            </ul>
        </div>

        <div class="content-section">
            <h2>‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (40%):</strong> –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ JSON –¥–∞–Ω–Ω—ã—Ö</li>
                <li><strong>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (25%):</strong> –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤</li>
                <li><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (20%):</strong> –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ JSON</li>
                <li><strong>–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (15%):</strong> –û–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ JSON</li>
            </ul>
        </div>

        <div class="solution-box">
            <h4>üí° –ü—Ä–∏–º–µ—Ä —Ä–µ—à–µ–Ω–∏—è</h4>
            <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä —Ä–µ—à–µ–Ω–∏—è:</p>
            <button onclick="toggleSolution()" class="nav-button" style="margin-top: 15px;">
                –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ
            </button>
            
            <div id="solution" style="display: none; margin-top: 20px;">
                <div class="code-example">
                    <code>// –ò–µ—Ä–∞—Ä—Ö–∏—è JSON —ç–ª–µ–º–µ–Ω—Ç–æ–≤
sealed class JsonElement {
    data class JsonObject(val properties: Map<String, JsonElement>) : JsonElement()
    data class JsonArray(val elements: List<JsonElement>) : JsonElement()
    data class JsonString(val value: String) : JsonElement()
    data class JsonNumber(val value: Double) : JsonElement()
    data class JsonBoolean(val value: Boolean) : JsonElement()
    object JsonNull : JsonElement()
}

// –¢–æ–∫–µ–Ω—ã –¥–ª—è –ª–µ–∫—Å–µ—Ä–∞
sealed class Token {
    data class StringToken(val value: String) : Token()
    data class NumberToken(val value: Double) : Token()
    data class BooleanToken(val value: Boolean) : Token()
    object NullToken : Token()
    
    object LeftBrace : Token()    // {
    object RightBrace : Token()   // }
    object LeftBracket : Token()  // [
    object RightBracket : Token() // ]
    object Colon : Token()        // :
    object Comma : Token()        // ,
    
    object EndOfFile : Token()
    data class Error(val message: String) : Token()
}

// –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
class JsonParseException(message: String) : Exception(message)

// –õ–µ–∫—Å–µ—Ä –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è JSON –Ω–∞ —Ç–æ–∫–µ–Ω—ã
class JsonLexer(private val input: String) {
    private var position = 0
    private var currentChar: Char? = if (position < input.length) input[position] else null
    
    fun tokenize(): List<Token> {
        val tokens = mutableListOf<Token>()
        
        while (currentChar != null) {
            when {
                currentChar!!.isWhitespace() -> advance()
                currentChar == '{' -> {
                    tokens.add(Token.LeftBrace)
                    advance()
                }
                currentChar == '}' -> {
                    tokens.add(Token.RightBrace)
                    advance()
                }
                currentChar == '[' -> {
                    tokens.add(Token.LeftBracket)
                    advance()
                }
                currentChar == ']' -> {
                    tokens.add(Token.RightBracket)
                    advance()
                }
                currentChar == ':' -> {
                    tokens.add(Token.Colon)
                    advance()
                }
                currentChar == ',' -> {
                    tokens.add(Token.Comma)
                    advance()
                }
                currentChar == '"' -> tokens.add(readString())
                currentChar!!.isDigit() || currentChar == '-' -> tokens.add(readNumber())
                else -> when {
                    input.startsWith("true", position) -> {
                        tokens.add(Token.BooleanToken(true))
                        position += 4
                        currentChar = if (position < input.length) input[position] else null
                    }
                    input.startsWith("false", position) -> {
                        tokens.add(Token.BooleanToken(false))
                        position += 5
                        currentChar = if (position < input.length) input[position] else null
                    }
                    input.startsWith("null", position) -> {
                        tokens.add(Token.NullToken)
                        position += 4
                        currentChar = if (position < input.length) input[position] else null
                    }
                    else -> throw JsonParseException("–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–∏–º–≤–æ–ª: '${currentChar}' –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ $position")
                }
            }
        }
        
        tokens.add(Token.EndOfFile)
        return tokens
    }
    
    private fun readString(): Token.StringToken {
        advance() // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–∫—Ä—ã–≤–∞—é—â—É—é –∫–∞–≤—ã—á–∫—É
        val value = buildString {
            while (currentChar != null && currentChar != '"') {
                when (currentChar) {
                    '\\\\' -> {
                        advance()
                        when (currentChar) {
                            'n' -> append('\\n')
                            't' -> append('\\t')
                            'r' -> append('\\r')
                            '\"' -> append('"')
                            '\\\\' -> append('\\\\')
                            '/' -> append('/')
                            else -> throw JsonParseException("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: \\\\${currentChar}")
                        }
                        advance()
                    }
                    else -> {
                        append(currentChar!!)
                        advance()
                    }
                }
            }
            if (currentChar == null) {
                throw JsonParseException("–ù–µ–∑–∞–∫—Ä—ã—Ç–∞—è —Å—Ç—Ä–æ–∫–∞")
            }
            advance() // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–∫—Ä—ã–≤–∞—é—â—É—é –∫–∞–≤—ã—á–∫—É
        }
        return Token.StringToken(value)
    }
    
    private fun readNumber(): Token.NumberToken {
        val start = position
        var hasDot = false
        var hasExponent = false
        
        if (currentChar == '-') advance()
        
        while (currentChar != null) {
            when {
                currentChar!!.isDigit() -> advance()
                currentChar == '.' && !hasDot -> {
                    hasDot = true
                    advance()
                }
                (currentChar == 'e' || currentChar == 'E') && !hasExponent -> {
                    hasExponent = true
                    advance()
                    if (currentChar == '+' || currentChar == '-') advance()
                }
                else -> break
            }
        }
        
        val numberStr = input.substring(start, position)
        return try {
            Token.NumberToken(numberStr.toDouble())
        } catch (e: NumberFormatException) {
            throw JsonParseException("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ: $numberStr")
        }
    }
    
    private fun advance() {
        position++
        currentChar = if (position < input.length) input[position] else null
    }
}

// –ü–∞—Ä—Å–µ—Ä JSON
class JsonParser(private val tokens: List<Token>) {
    private var position = 0
    private var currentToken: Token = tokens[0]
    
    fun parse(): JsonElement.JsonObject {
        return parseObject()
    }
    
    private fun parseObject(): JsonElement.JsonObject {
        consume<Token.LeftBrace>()
        
        val properties = mutableMapOf<String, JsonElement>()
        
        if (currentToken !is Token.RightBrace) {
            do {
                val key = parseString()
                consume<Token.Colon>()
                val value = parseValue()
                properties[key] = value
            } while (match<Token.Comma>())
        }
        
        consume<Token.RightBrace>()
        return JsonElement.JsonObject(properties)
    }
    
    private fun parseArray(): JsonElement.JsonArray {
        consume<Token.LeftBracket>()
        
        val elements = mutableListOf<JsonElement>()
        
        if (currentToken !is Token.RightBracket) {
            do {
                elements.add(parseValue())
            } while (match<Token.Comma>())
        }
        
        consume<Token.RightBracket>()
        return JsonElement.JsonArray(elements)
    }
    
    private fun parseValue(): JsonElement {
        return when (currentToken) {
            is Token.LeftBrace -> parseObject()
            is Token.LeftBracket -> parseArray()
            is Token.StringToken -> {
                val value = (currentToken as Token.StringToken).value
                advance()
                JsonElement.JsonString(value)
            }
            is Token.NumberToken -> {
                val value = (currentToken as Token.NumberToken).value
                advance()
                JsonElement.JsonNumber(value)
            }
            is Token.BooleanToken -> {
                val value = (currentToken as Token.BooleanToken).value
                advance()
                JsonElement.JsonBoolean(value)
            }
            is Token.NullToken -> {
                advance()
                JsonElement.JsonNull
            }
            else -> throw JsonParseException("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω: $currentToken")
        }
    }
    
    private fun parseString(): String {
        if (currentToken !is Token.StringToken) {
            throw JsonParseException("–û–∂–∏–¥–∞–ª–∞—Å—å —Å—Ç—Ä–æ–∫–∞, –Ω–∞–π–¥–µ–Ω–æ: $currentToken")
        }
        val value = (currentToken as Token.StringToken).value
        advance()
        return value
    }
    
    private inline fun <reified T : Token> consume() {
        if (currentToken !is T) {
            throw JsonParseException("–û–∂–∏–¥–∞–ª—Å—è —Ç–æ–∫–µ–Ω ${T::class.simpleName}, –Ω–∞–π–¥–µ–Ω: $currentToken")
        }
        advance()
    }
    
    private inline fun <reified T : Token> match(): Boolean {
        return if (currentToken is T) {
            advance()
            true
        } else {
            false
        }
    }
    
    private fun advance() {
        position++
        currentToken = tokens.getOrNull(position) ?: Token.EndOfFile
    }
}

// –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä
object JsonSerializer {
    fun serialize(element: JsonElement): String {
        return when (element) {
            is JsonElement.JsonObject -> {
                val properties = element.properties.entries.joinToString(", ") { (key, value) ->
                    "\"$key\":${serialize(value)}"
                }
                "{$properties}"
            }
            is JsonElement.JsonArray -> {
                val elements = element.elements.joinToString(", ") { serialize(it) }
                "[$elements]"
            }
            is JsonElement.JsonString -> "\"${escapeString(element.value)}\""
            is JsonElement.JsonNumber -> element.value.toString()
            is JsonElement.JsonBoolean -> element.value.toString()
            JsonElement.JsonNull -> "null"
        }
    }
    
    private fun escapeString(str: String): String {
        return str.replace("\\\\", "\\\\\\\\")
                 .replace("\"", "\\\"")
                 .replace("\\n", "\\\\n")
                 .replace("\\t", "\\\\t")
                 .replace("\\r", "\\\\r")
                 .replace("/", "\\/")
    }
}

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã
data class Person(
    val name: String,
    val age: Int,
    val city: String,
    val isMarried: Boolean,
    val hobbies: List<String>,
    val address: Address?
)

data class Address(
    val street: String,
    val houseNumber: Int,
    val postalCode: String
)

// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤
fun <T> T.toJsonElement(): JsonElement {
    return when (this) {
        null -> JsonElement.JsonNull
        is String -> JsonElement.JsonString(this)
        is Number -> JsonElement.JsonNumber(this.toDouble())
        is Boolean -> JsonElement.JsonBoolean(this)
        is List<*> -> JsonElement.JsonArray(this.map { it?.toJsonElement() })
        is Map<*, *> -> JsonElement.JsonObject(this.entries.associate { 
            it.key.toString() to (it.value?.toJsonElement() ?: JsonElement.JsonNull)
        })
        else -> throw IllegalArgumentException("–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø: ${this::class}")
    }
}

fun main() {
    val testJson = """
        {
            "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
            "age": 30,
            "city": "–ú–æ—Å–∫–≤–∞",
            "isMarried": true,
            "hobbies": ["–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "—á—Ç–µ–Ω–∏–µ", "—Å–ø–æ—Ä—Ç"],
            "address": {
                "street": "—É–ª. –õ–µ–Ω–∏–Ω–∞",
                "houseNumber": 123,
                "postalCode": "123456"
            }
        }
    """.trimIndent()
    
    while (true) {
        println("\\n=== –ü–ê–†–°–ï–† JSON ===")
        println("1. –ü–∞—Ä—Å–∏–Ω–≥ JSON")
        println("2. –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞")
        println("3. –í–∞–ª–∏–¥–∞—Ü–∏—è JSON")
        println("4. –ü—Ä–∏–º–µ—Ä—ã")
        println("0. –í—ã—Ö–æ–¥")
        
        print("–í–∞—à –≤—ã–±–æ—Ä: ")
        val choice = readLine()?.toIntOrNull()
        
        when (choice) {
            0 -> break
            1 -> parseJson()
            2 -> serializeObject()
            3 -> validateJson()
            4 -> showExamples()
            else -> println("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        }
    }
}

fun parseJson() {
    println("\\n–í–≤–µ–¥–∏—Ç–µ JSON —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞:")
    val jsonString = readLine()?.trim() ?: ""
    
    if (jsonString.isEmpty()) {
        println("–ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!")
        return
    }
    
    try {
        val lexer = JsonLexer(jsonString)
        val tokens = lexer.tokenize()
        println("\\n–¢–æ–∫–µ–Ω—ã:")
        tokens.forEach { println("  $it") }
        
        val parser = JsonParser(tokens)
        val result = parser.parse()
        
        println("\\n–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞:")
        println(result)
        
        println("\\n–°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω –æ–±—Ä–∞—Ç–Ω–æ:")
        println(JsonSerializer.serialize(result))
        
    } catch (e: Exception) {
        println("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ${e.message}")
    }
}

fun serializeObject() {
    val person = Person(
        name = "–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤",
        age = 28,
        city = "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
        isMarried = false,
        hobbies = listOf("–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "–∏–≥—Ä—ã", "–º—É–∑—ã–∫–∞"),
        address = Address(
            street = "–ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç",
            houseNumber = 28,
            postalCode = "191025"
        )
    )
    
    println("\\n–ò—Å—Ö–æ–¥–Ω—ã–π –æ–±—ä–µ–∫—Ç: $person")
    
    try {
        val jsonElement = person.toJsonElement()
        val jsonString = JsonSerializer.serialize(jsonElement)
        
        println("\\nJSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç:")
        println(jsonString)
        
        // –ü–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
        val lexer = JsonLexer(jsonString)
        val tokens = lexer.tokenize()
        val parser = JsonParser(tokens)
        val parsed = parser.parse()
        
        println("\\n–û–±—Ä–∞—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω:")
        println(parsed)
        
    } catch (e: Exception) {
        println("–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${e.message}")
    }
}

fun validateJson() {
    println("\\n–í–≤–µ–¥–∏—Ç–µ JSON —Å—Ç—Ä–æ–∫—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:")
    val jsonString = readLine()?.trim() ?: ""
    
    if (jsonString.isEmpty()) {
        println("–ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!")
        return
    }
    
    try {
        val lexer = JsonLexer(jsonString)
        val tokens = lexer.tokenize()
        val parser = JsonParser(tokens)
        parser.parse()
        println("‚úÖ JSON –≤–∞–ª–∏–¥–µ–Ω!")
        
    } catch (e: Exception) {
        println("‚ùå JSON –Ω–µ–≤–∞–ª–∏–¥–µ–Ω:")
        println("–û—à–∏–±–∫–∞: ${e.message}")
    }
}

fun showExamples() {
    println("\\n=== –ü–†–ò–ú–ï–†–´ JSON ===")
    
    val examples = listOf(
        """{"name": "–ü—Ä–∏–º–µ—Ä", "value": 42}""",
        """[1, 2, 3, "—á–µ—Ç—ã—Ä–µ", true, null]""",
        """{"user": {"name": "–ò–≤–∞–Ω", "age": 25}, "items": [1, 2, 3]}""",
        """{"—Å—Ç—Ä–æ–∫–∞ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏": "–∑–Ω–∞—á–µ–Ω–∏–µ", "—á–∏—Å–ª–∞": 123.45, "–±—É–ª–µ–≤–æ": false}""",
        """{"–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤": [{"id": 1, "name": "–ü–µ—Ä–≤—ã–π"}, {"id": 2, "name": "–í—Ç–æ—Ä–æ–π"}]}"""
    )
    
    examples.forEachIndexed { index, example ->
        println("\\n–ü—Ä–∏–º–µ—Ä ${index + 1}:")
        println(example)
        
        try {
            val lexer = JsonLexer(example)
            val tokens = lexer.tokenize()
            val parser = JsonParser(tokens)
            val result = parser.parse()
            println("‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω: ${result::class.simpleName}")
        } catch (e: Exception) {
            println("‚ùå –û—à–∏–±–∫–∞: ${e.message}")
        }
    }
}</code>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è</h2>
            <p>–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>–ü–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ JSON</li>
                <li>Pretty-print —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏</li>
                <li>–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤</li>
                <li>–ü–æ–¥–¥–µ—Ä–∂–∫—É –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏</li>
                <li>–†–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ JSON —Ñ–∞–π–ª–∞–º–∏</li>
            </ul>
        </div>

        <div class="navigation">
            <a href="course-kotlin.html" class="nav-button">‚Üê –ù–∞–∑–∞–¥ –∫ –∫—É—Ä—Å—É</a>
            <button onclick="markAssignmentCompleted(6)" class="nav-button" style="border: none; cursor: pointer;">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            <a href="kotlin-assignment-7.html" class="nav-button">–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Üí</a>
        </div>
        
        <script>
            function toggleSolution() {
                const solution = document.getElementById('solution');
                const button = event.target;
                
                if (solution.style.display === 'none') {
                    solution.style.display = 'block';
                    button.textContent = '–°–∫—Ä—ã—Ç—å —Ä–µ—à–µ–Ω–∏–µ';
                } else {
                    solution.style.display = 'none';
                    button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ';
                }
            }
            
            function markAssignmentCompleted(assignmentNum) {
                const completedAssignments = JSON.parse(localStorage.getItem('completedKotlinAssignments') || '[]');
                if (!completedAssignments.includes(assignmentNum)) {
                    completedAssignments.push(assignmentNum);
                    localStorage.setItem('completedKotlinAssignments', JSON.stringify(completedAssignments));
                    alert('–ó–∞–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üìä');
                } else {
                    alert('–≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–µ.');
                }
            }
        </script>
    </div>
</body>
</html>