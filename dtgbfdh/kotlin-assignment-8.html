<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–¥–∞–Ω–∏–µ 8: HTTP –∫–ª–∏–µ–Ω—Ç - CodeLearn</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            line-height: 1.6;
        }
        .header {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.8em; font-weight: bold; text-decoration: none; color: white; }
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            text-decoration: none;
            transition: background 0.3s ease;
        }
        .back-btn:hover { background: rgba(255, 255, 255, 0.3); }
        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .assignment-header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
        }
        .assignment-title {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .assignment-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .content-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        .content-section h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        .content-section h3 {
            color: #ffd700;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
        }
        .content-section p { margin-bottom: 15px; font-size: 1.1em; }
        .code-example {
            background: rgba(0, 0, 0, 0.4);
            border-left: 4px solid #ffd700;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .code-example code {
            color: #00ff00;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .task-box {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .task-box h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }
        .solution-box {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .solution-box h4 {
            color: #51cf66;
            margin-bottom: 10px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }
        .nav-button {
            background: #ffd700;
            color: #333;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        .nav-button:hover { transform: translateY(-2px); }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <a href="courses.html" class="logo">üöÄ CodeLearn</a>
            <a href="course-kotlin.html" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –∫—É—Ä—Å—É</a>
        </div>
    </header>

    <div class="container">
        <div class="assignment-header">
            <h1 class="assignment-title">–ó–∞–¥–∞–Ω–∏–µ 8: HTTP –∫–ª–∏–µ–Ω—Ç</h1>
            <div class="assignment-meta">
                <span>üÖ∫ Kotlin</span>
                <span>‚è±Ô∏è 135 –º–∏–Ω—É—Ç</span>
                <span>üìù –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ</span>
            </div>
        </div>

        <div class="content-section">
            <h2>üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç –Ω–∞ Kotlin —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.</p>
        </div>

        <div class="content-section">
            <h2>üéØ –¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>–†–∞–±–æ—Ç–∞—Ç—å —Å HTTP –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º</li>
                <li>–°–æ–∑–¥–∞–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å HTTP –∑–∞–ø—Ä–æ—Å—ã</li>
                <li>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞</li>
                <li>–†–∞–±–æ—Ç–∞—Ç—å —Å JSON –¥–∞–Ω–Ω—ã–º–∏</li>
                <li>–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</li>
                <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</li>
            </ul>
        </div>

        <div class="task-box">
            <h4>üìù –ó–∞–¥–∞—á–∞</h4>
            <p>–°–æ–∑–¥–∞–π—Ç–µ HTTP –∫–ª–∏–µ–Ω—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π GET, POST, PUT, DELETE –∑–∞–ø—Ä–æ—Å–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, cookies, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å JSON.</p>
        </div>

        <div class="content-section">
            <h2>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HttpURLConnection –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞</li>
                <li>–°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å—ã –¥–ª—è HTTP –º–µ—Ç–æ–¥–æ–≤ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</li>
                <li>–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–æ–≤</li>
                <li>–î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</li>
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</li>
            </ul>
        </div>

        <div class="content-section">
            <h2>üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è</h2>
            
            <h3>1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å HttpClient</h3>
            <div class="code-example">
                <code>class HttpClient {
    private val baseUrl: String
    private val defaultHeaders: MutableMap<String, String>
    
    suspend fun get(url: String): HttpResponse
    suspend fun post(url: String, body: String): HttpResponse
    suspend fun put(url: String, body: String): HttpResponse
    suspend fun delete(url: String): HttpResponse
}</code>
            </div>

            <h3>2. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å—ã –¥–ª—è HTTP –¥–∞–Ω–Ω—ã—Ö</h3>
            <div class="code-example">
                <code>data class HttpResponse(
    val statusCode: Int,
    val headers: Map<String, String>,
    val body: String,
    val cookies: Map<String, String>
)

data class RequestOptions(
    val headers: Map<String, String> = emptyMap(),
    val timeout: Int = 10000,
    val followRedirects: Boolean = true
)</code>
            </div>

            <h3>3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–±—Ä–∏–∫—É HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
            <div class="code-example">
                <code>object HttpClientFactory {
    fun createClient(baseUrl: String): HttpClient
    fun createAuthenticatedClient(baseUrl: String, token: String): HttpClient
}</code>
            </div>
        </div>

        <div class="content-section">
            <h2>üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞</h2>
            <div class="code-example">
                <code>=== HTTP –ö–õ–ò–ï–ù–¢ ===
–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é:
1. GET –∑–∞–ø—Ä–æ—Å
2. POST –∑–∞–ø—Ä–æ—Å
3. PUT –∑–∞–ø—Ä–æ—Å
4. DELETE –∑–∞–ø—Ä–æ—Å
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
0. –í—ã—Ö–æ–¥

–í–∞—à –≤—ã–±–æ—Ä: 1
–í–≤–µ–¥–∏—Ç–µ URL: https://jsonplaceholder.typicode.com/posts/1

=== –û–¢–í–ï–¢ ===
–°—Ç–∞—Ç—É—Å: 200 OK
–ó–∞–≥–æ–ª–æ–≤–∫–∏: {Content-Type=application/json, ...}
–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞:
{
  "userId": 1,
  "id": 1,
  "title": "sunt aut...",
  "body": "quia et..."
}

–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 245–º—Å
–†–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞: 156 –±–∞–π—Ç</code>
            </div>
        </div>

        <div class="content-section">
            <h2>üîß –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>–ú–µ—Ç–æ–¥—ã:</strong> GET, POST, PUT, PATCH, DELETE, HEAD, OPTIONS</li>
                <li><strong>–ó–∞–≥–æ–ª–æ–≤–∫–∏:</strong> Content-Type, Authorization, User-Agent, Custom</li>
                <li><strong>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:</strong> Basic Auth, Bearer Token, API Key</li>
                <li><strong>–ö–æ–Ω—Ç–µ–Ω—Ç:</strong> JSON, Form Data, Plain Text, XML</li>
                <li><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞:</strong> Cookies, Redirects, Timeouts</li>
            </ul>
        </div>

        <div class="content-section">
            <h2>üåê –ü—Ä–∏–º–µ—Ä—ã API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>JSONPlaceholder:</strong> https://jsonplaceholder.typicode.com/</li>
                <li><strong>RestCountries:</strong> https://restcountries.com/v3.1/</li>
                <li><strong>Dog API:</strong> https://dog.ceo/api/breeds/list/all</li>
                <li><strong>HTTPBin:</strong> https://httpbin.org/</li>
                <li><strong>JSON Server:</strong> https://json-server.herokuapp.com/</li>
            </ul>
        </div>

        <div class="content-section">
            <h2>‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏</h2>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (40%):</strong> –í—Å–µ HTTP –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç</li>
                <li><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (25%):</strong> –†–∞–±–æ—Ç–∞ —Å JSON –∏ –¥—Ä—É–≥–∏–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏</li>
                <li><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (20%):</strong> –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫</li>
                <li><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (15%):</strong> –£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</li>
            </ul>
        </div>

        <div class="solution-box">
            <h4>üí° –ü—Ä–∏–º–µ—Ä —Ä–µ—à–µ–Ω–∏—è</h4>
            <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä —Ä–µ—à–µ–Ω–∏—è:</p>
            <button onclick="toggleSolution()" class="nav-button" style="margin-top: 15px;">
                –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ
            </button>
            
            <div id="solution" style="display: none; margin-top: 20px;">
                <div class="code-example">
                    <code>import kotlinx.coroutines.*
import java.net.*
import java.io.*
import java.util.concurrent.TimeUnit
import java.util.Base64

data class HttpResponse(
    val statusCode: Int,
    val headers: Map<String, String>,
    val body: String,
    val cookies: Map<String, String>,
    val responseTime: Long
)

data class RequestOptions(
    val headers: Map<String, String> = emptyMap(),
    val timeout: Int = 30000,
    val followRedirects: Boolean = true,
    val userAgent: String = "Kotlin HttpClient/1.0"
)

data class HttpRequest(
    val method: String,
    val url: String,
    val headers: Map<String, String> = emptyMap(),
    val body: String = ""
)

sealed class HttpException(message: String) : Exception(message) {
    class NetworkException(message: String) : HttpException("–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: $message")
    class TimeoutException : HttpException("–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è")
    class ServerException(statusCode: Int, message: String) : HttpException("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ $statusCode: $message")
    class AuthenticationException : HttpException("–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏")
}

class HttpClient(
    private val baseUrl: String = "",
    private val defaultOptions: RequestOptions = RequestOptions()
) {
    private val defaultHeaders = mutableMapOf<String, String>()
    
    init {
        defaultHeaders["User-Agent"] = defaultOptions.userAgent
        defaultHeaders["Accept"] = "application/json, */*"
    }
    
    suspend fun get(url: String, options: RequestOptions = defaultOptions): HttpResponse {
        return request(HttpRequest("GET", buildUrl(url), options.headers))
    }
    
    suspend fun post(url: String, body: String = "", options: RequestOptions = defaultOptions): HttpResponse {
        val headers = options.headers.toMutableMap()
        if (!headers.containsKey("Content-Type")) {
            headers["Content-Type"] = "application/json"
        }
        return request(HttpRequest("POST", buildUrl(url), headers, body))
    }
    
    suspend fun put(url: String, body: String = "", options: RequestOptions = defaultOptions): HttpResponse {
        val headers = options.headers.toMutableMap()
        if (!headers.containsKey("Content-Type")) {
            headers["Content-Type"] = "application/json"
        }
        return request(HttpRequest("PUT", buildUrl(url), headers, body))
    }
    
    suspend fun patch(url: String, body: String = "", options: RequestOptions = defaultOptions): HttpResponse {
        val headers = options.headers.toMutableMap()
        if (!headers.containsKey("Content-Type")) {
            headers["Content-Type"] = "application/json"
        }
        return request(HttpRequest("PATCH", buildUrl(url), headers, body))
    }
    
    suspend fun delete(url: String, options: RequestOptions = defaultOptions): HttpResponse {
        return request(HttpRequest("DELETE", buildUrl(url), options.headers))
    }
    
    suspend fun head(url: String, options: RequestOptions = defaultOptions): HttpResponse {
        return request(HttpRequest("HEAD", buildUrl(url), options.headers))
    }
    
    suspend fun options(url: String, options: RequestOptions = defaultOptions): HttpResponse {
        return request(HttpRequest("OPTIONS", buildUrl(url), options.headers))
    }
    
    private fun buildUrl(url: String): String {
        return if (baseUrl.isNotEmpty() && !url.startsWith("http")) {
            "$baseUrl/$url"
        } else {
            url
        }
    }
    
    private suspend fun request(request: HttpRequest): HttpResponse = withContext(Dispatchers.IO) {
        val startTime = System.currentTimeMillis()
        
        try {
            val url = URL(request.url)
            val connection = url.openConnection() as HttpURLConnection
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            connection.requestMethod = request.method
            connection.connectTimeout = defaultOptions.timeout
            connection.readTimeout = defaultOptions.timeout
            connection.instanceFollowRedirects = defaultOptions.followRedirects
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            request.headers.forEach { (key, value) ->
                connection.setRequestProperty(key, value)
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç
            if (request.body.isNotEmpty() && request.method in listOf("POST", "PUT", "PATCH")) {
                connection.doOutput = true
                connection.outputStream.use { outputStream ->
                    outputStream.write(request.body.toByteArray())
                }
            }
            
            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
            val responseCode = connection.responseCode
            val responseHeaders = connection.headerFields
            val responseBody = if (responseCode < 400) {
                connection.inputStream.bufferedReader().use { it.readText() }
            } else {
                connection.errorStream?.bufferedReader()?.use { it.readText() } ?: ""
            }
            
            // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ cookies
            val cookies = extractCookies(connection)
            
            val responseTime = System.currentTimeMillis() - startTime
            
            connection.disconnect()
            
            HttpResponse(
                statusCode = responseCode,
                headers = responseHeaders.mapValues { it.value.joinToString(", ") },
                body = responseBody,
                cookies = cookies,
                responseTime = responseTime
            )
            
        } catch (e: SocketTimeoutException) {
            throw HttpException.TimeoutException()
        } catch (e: IOException) {
            throw HttpException.NetworkException(e.message ?: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞")
        }
    }
    
    private fun extractCookies(connection: HttpURLConnection): Map<String, String> {
        val cookies = mutableMapOf<String, String>()
        
        connection.headerFields["Set-Cookie"]?.forEach { cookie ->
            val parts = cookie.split(";")[0].split("=", limit = 2)
            if (parts.size == 2) {
                cookies[parts[0]] = parts[1]
            }
        }
        
        return cookies
    }
}

object HttpClientFactory {
    fun createClient(baseUrl: String = ""): HttpClient {
        return HttpClient(baseUrl)
    }
    
    fun createAuthenticatedClient(baseUrl: String, token: String): HttpClient {
        val client = HttpClient(baseUrl)
        val authHeader = "Bearer $token"
        client.setDefaultHeader("Authorization", authHeader)
        return client
    }
    
    fun createBasicAuthClient(baseUrl: String, username: String, password: String): HttpClient {
        val client = HttpClient(baseUrl)
        val credentials = Base64.getEncoder().encodeToString("$username:$password".toByteArray())
        client.setDefaultHeader("Authorization", "Basic $credentials")
        return client
    }
    
    fun createApiKeyClient(baseUrl: String, apiKey: String, headerName: String = "X-API-Key"): HttpClient {
        val client = HttpClient(baseUrl)
        client.setDefaultHeader(headerName, apiKey)
        return client
    }
}

// –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
fun HttpClient.setDefaultHeader(key: String, value: String) {
    // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –º–µ—Ö–∞–Ω–∏–∑–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
}

// JSON —É—Ç–∏–ª–∏—Ç—ã
object JsonUtils {
    fun formatJson(json: String): String {
        return try {
            val parser = org.json.JSONObject(json)
            parser.toString(4)
        } catch (e: Exception) {
            json
        }
    }
    
    fun prettyPrintJson(json: String): String {
        return try {
            val parser = org.json.JSONObject(json)
            parser.toString(2)
        } catch (e: Exception) {
            try {
                val parser = org.json.JSONArray(json)
                parser.toString(2)
            } catch (e2: Exception) {
                json
            }
        }
    }
}

// HTTP —É—Ç–∏–ª–∏—Ç—ã
object HttpUtils {
    fun isSuccess(statusCode: Int): Boolean = statusCode in 200..299
    fun isRedirect(statusCode: Int): Boolean = statusCode in 300..399
    fun isClientError(statusCode: Int): Boolean = statusCode in 400..499
    fun isServerError(statusCode: Int): Boolean = statusCode in 500..599
    
    fun getStatusText(statusCode: Int): String {
        return when (statusCode) {
            200 -> "OK"
            201 -> "Created"
            400 -> "Bad Request"
            401 -> "Unauthorized"
            403 -> "Forbidden"
            404 -> "Not Found"
            500 -> "Internal Server Error"
            502 -> "Bad Gateway"
            503 -> "Service Unavailable"
            else -> "Unknown"
        }
    }
}

class ApiTester {
    private val client = HttpClientFactory.createClient()
    
    suspend fun testPublicApi() {
        println("\\n=== –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PUBLIC API ===")
        
        try {
            println("\\n1. –¢–µ—Å—Ç JSONPlaceholder API:")
            val postsResponse = client.get("https://jsonplaceholder.typicode.com/posts")
            println("–°—Ç–∞—Ç—É—Å: ${postsResponse.statusCode}")
            println("–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${postsResponse.responseTime}–º—Å")
            
            if (postsResponse.body.isNotEmpty()) {
                println("–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç–≤–µ—Ç–∞:")
                println(postsResponse.body.take(200) + "...")
            }
            
            println("\\n2. –¢–µ—Å—Ç Dog API:")
            val dogResponse = client.get("https://dog.ceo/api/breeds/list/all")
            println("–°—Ç–∞—Ç—É—Å: ${dogResponse.statusCode}")
            println("–û—Ç–≤–µ—Ç: ${JsonUtils.formatJson(dogResponse.body)}")
            
            println("\\n3. –¢–µ—Å—Ç HTTPBin (POST):")
            val postResponse = client.post("https://httpbin.org/post", 
                """{"message": "Hello from Kotlin!", "timestamp": ${System.currentTimeMillis()}}""")
            println("–°—Ç–∞—Ç—É—Å: ${postResponse.statusCode}")
            println("–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${postResponse.responseTime}–º—Å")
            
        } catch (e: HttpException) {
            println("–û—à–∏–±–∫–∞ API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${e.message}")
        } catch (e: Exception) {
            println("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: ${e.message}")
        }
    }
    
    suspend fun interactiveTest() {
        println("\\n=== –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï ===")
        
        while (true) {
            println("\\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:")
            println("1. GET –∑–∞–ø—Ä–æ—Å")
            println("2. POST –∑–∞–ø—Ä–æ—Å")
            println("3. PUT –∑–∞–ø—Ä–æ—Å")
            println("4. DELETE –∑–∞–ø—Ä–æ—Å")
            println("5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ API")
            println("0. –ù–∞–∑–∞–¥")
            
            print("–í–∞—à –≤—ã–±–æ—Ä: ")
            val choice = readLine()?.toIntOrNull()
            
            when (choice) {
                0 -> break
                1 -> performGet()
                2 -> performPost()
                3 -> performPut()
                4 -> performDelete()
                5 -> testPublicApi()
                else -> println("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä")
            }
        }
    }
    
    private suspend fun performGet() {
        print("–í–≤–µ–¥–∏—Ç–µ URL: ")
        val url = readLine()?.trim() ?: return
        
        try {
            val response = client.get(url)
            printResponse(response)
        } catch (e: HttpException) {
            println("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${e.message}")
        }
    }
    
    private suspend fun performPost() {
        print("–í–≤–µ–¥–∏—Ç–µ URL: ")
        val url = readLine()?.trim() ?: return
        
        print("–í–≤–µ–¥–∏—Ç–µ JSON –¥–∞–Ω–Ω—ã–µ: ")
        val body = readLine()?.trim() ?: "{}"
        
        try {
            val response = client.post(url, body)
            printResponse(response)
        } catch (e: HttpException) {
            println("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${e.message}")
        }
    }
    
    private suspend fun performPut() {
        print("–í–≤–µ–¥–∏—Ç–µ URL: ")
        val url = readLine()?.trim() ?: return
        
        print("–í–≤–µ–¥–∏—Ç–µ JSON –¥–∞–Ω–Ω—ã–µ: ")
        val body = readLine()?.trim() ?: "{}"
        
        try {
            val response = client.put(url, body)
            printResponse(response)
        } catch (e: HttpException) {
            println("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${e.message}")
        }
    }
    
    private suspend fun performDelete() {
        print("–í–≤–µ–¥–∏—Ç–µ URL: ")
        val url = readLine()?.trim() ?: return
        
        try {
            val response = client.delete(url)
            printResponse(response)
        } catch (e: HttpException) {
            println("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${e.message}")
        }
    }
    
    private fun printResponse(response: HttpResponse) {
        println("\\n=== –û–¢–í–ï–¢ ===")
        println("–°—Ç–∞—Ç—É—Å: ${response.statusCode} ${HttpUtils.getStatusText(response.statusCode)}")
        println("–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${response.responseTime}–º—Å")
        println("–†–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞: ${response.body.length} –±–∞–π—Ç")
        
        if (response.headers.isNotEmpty()) {
            println("\\n–ó–∞–≥–æ–ª–æ–≤–∫–∏:")
            response.headers.forEach { (key, value) ->
                println("  $key: $value")
            }
        }
        
        if (response.body.isNotEmpty()) {
            println("\\n–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞:")
            val formattedBody = if (response.body.trim().startsWith("{") || response.body.trim().startsWith("[")) {
                JsonUtils.prettyPrintJson(response.body)
            } else {
                response.body
            }
            println(formattedBody)
        }
        
        if (response.cookies.isNotEmpty()) {
            println("\\nCookies:")
            response.cookies.forEach { (key, value) ->
                println("  $key: $value")
            }
        }
    }
}

fun main() = runBlocking {
    val tester = ApiTester()
    
    while (true) {
        println("\\n=== HTTP –ö–õ–ò–ï–ù–¢ ===")
        println("1. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ")
        println("2. –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API")
        println("3. –°–æ–∑–¥–∞—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç")
        println("0. –í—ã—Ö–æ–¥")
        
        print("–í–∞—à –≤—ã–±–æ—Ä: ")
        val choice = readLine()?.toIntOrNull()
        
        when (choice) {
            0 -> {
                println("–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
                break
            }
            1 -> tester.interactiveTest()
            2 -> tester.testPublicApi()
            3 -> createAuthenticatedClient()
            else -> println("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        }
    }
}

fun createAuthenticatedClient() = runBlocking {
    println("\\n=== –°–û–ó–î–ê–ù–ò–ï –ê–£–¢–ï–ù–¢–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–û–ì–û –ö–õ–ò–ï–ù–¢–ê ===")
    println("–¢–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:")
    println("1. Bearer Token")
    println("2. Basic Auth")
    println("3. API Key")
    println("0. –ù–∞–∑–∞–¥")
    
    print("–í–∞—à –≤—ã–±–æ—Ä: ")
    val authChoice = readLine()?.toIntOrNull()
    
    when (authChoice) {
        0 -> return@runBlocking
        1 -> {
            print("–í–≤–µ–¥–∏—Ç–µ base URL: ")
            val baseUrl = readLine()?.trim() ?: ""
            print("–í–≤–µ–¥–∏—Ç–µ Bearer token: ")
            val token = readLine()?.trim() ?: ""
            
            val client = HttpClientFactory.createAuthenticatedClient(baseUrl, token)
            println("–ö–ª–∏–µ–Ω—Ç —Å Bearer –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —Å–æ–∑–¥–∞–Ω!")
        }
        2 -> {
            print("–í–≤–µ–¥–∏—Ç–µ base URL: ")
            val baseUrl = readLine()?.trim() ?: ""
            print("–í–≤–µ–¥–∏—Ç–µ username: ")
            val username = readLine()?.trim() ?: ""
            print("–í–≤–µ–¥–∏—Ç–µ password: ")
            val password = readLine()?.trim() ?: ""
            
            val client = HttpClientFactory.createBasicAuthClient(baseUrl, username, password)
            println("–ö–ª–∏–µ–Ω—Ç —Å Basic Auth —Å–æ–∑–¥–∞–Ω!")
        }
        3 -> {
            print("–í–≤–µ–¥–∏—Ç–µ base URL: ")
            val baseUrl = readLine()?.trim() ?: ""
            print("–í–≤–µ–¥–∏—Ç–µ API Key: ")
            val apiKey = readLine()?.trim() ?: ""
            
            val client = HttpClientFactory.createApiKeyClient(baseUrl, apiKey)
            println("–ö–ª–∏–µ–Ω—Ç —Å API Key –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —Å–æ–∑–¥–∞–Ω!")
        }
        else -> println("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä")
    }
}</code>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è</h2>
            <p>–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>–ü–æ–¥–¥–µ—Ä–∂–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤</li>
                <li>–†–µ–∞–ª–∏–∑–∞—Ü–∏—é retry –º–µ—Ö–∞–Ω–∏–∑–º–∞</li>
                <li>–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤</li>
                <li>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤</li>
                <li>–ü–æ–¥–¥–µ—Ä–∂–∫—É WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π</li>
            </ul>
        </div>

        <div class="navigation">
            <a href="course-kotlin.html" class="nav-button">‚Üê –ù–∞–∑–∞–¥ –∫ –∫—É—Ä—Å—É</a>
            <button onclick="markAssignmentCompleted(8)" class="nav-button" style="border: none; cursor: pointer;">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            <a href="kotlin-assignment-9.html" class="nav-button">–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Üí</a>
        </div>
        
        <script>
            function toggleSolution() {
                const solution = document.getElementById('solution');
                const button = event.target;
                
                if (solution.style.display === 'none') {
                    solution.style.display = 'block';
                    button.textContent = '–°–∫—Ä—ã—Ç—å —Ä–µ—à–µ–Ω–∏–µ';
                } else {
                    solution.style.display = 'none';
                    button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ';
                }
            }
            
            function markAssignmentCompleted(assignmentNum) {
                const completedAssignments = JSON.parse(localStorage.getItem('completedKotlinAssignments') || '[]');
                if (!completedAssignments.includes(assignmentNum)) {
                    completedAssignments.push(assignmentNum);
                    localStorage.setItem('completedKotlinAssignments', JSON.stringify(completedAssignments));
                    alert('–ó–∞–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üåê');
                } else {
                    alert('–≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–µ.');
                }
            }
        </script>
    </div>
</body>
</html>